// Generated by CoffeeScript 1.6.2
(function() {
  var FnFetch;

  FnFetch = (function() {
    /*
    */
    function FnFetch(field) {
      this.field = field;
    }

    /*
    */


    FnFetch.prototype.fetch = function(payload, next) {
      var method, _ref,
        _this = this;

      method = payload.method;
      return payload.model._memoizer.call(this.field.path, (_ref = this.field.options.memoize) != null ? _ref : {
        maxAge: 1000 * 5
      }, next, function(next) {
        var fn;

        if (!(fn = _this.field.options.fetch[method])) {
          return next(new Error("method \"" + method + "\" on \"" + _this.field.path + "\" doesn't exist"));
        }
        payload.field = _this.field;
        return fn.call(payload.model, payload, function(err, result) {
          if (result == null) {
            result = {};
          }
          return setTimeout((function() {
            if (err != null) {
              return next(err);
            }
            _this.field.reset(payload.model, result);
            return next();
          }), 0);
        });
      });
    };

    return FnFetch;

  })();

  module.exports = FnFetch;

}).call(this);
