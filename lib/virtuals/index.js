// Generated by CoffeeScript 1.6.2
(function() {
  var CollectionMapper, FnMapper, Virtual, async;

  CollectionMapper = require("./collection");

  FnMapper = require("./fn");

  async = require("async");

  Virtual = (function() {
    /*
    */
    function Virtual(field) {
      var ops;

      this.field = field;
      ops = this.field.options;
      this._virtuals = [];
      if (ops["default"] != null) {
        this._virtuals.push(new DefaultMapper(this.field));
      }
      this._virtuals.push(new FnMapper(this.field));
      if (ops.multi) {
        this._virtuals.push(new CollectionMapper(this.field));
      } else if (ops.ref) {
        this._virtuals.push(new ReferenceMapper(this.field));
      }
    }

    /*
    */


    Virtual.prototype.fetch = function(model, next) {
      if (next == null) {
        next = function() {};
      }
      return async.forEach(this._virtuals, (function(mapper, next) {
        return mapper.fetch(model, next);
      }), next);
    };

    /*
    */


    Virtual.prototype.cast = function(data) {
      var virtual, _i, _len, _ref;

      _ref = this._virtuals;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        virtual = _ref[_i];
        data = virtual.cast(data);
      }
      return data;
    };

    return Virtual;

  })();

  module.exports = Virtual;

}).call(this);
